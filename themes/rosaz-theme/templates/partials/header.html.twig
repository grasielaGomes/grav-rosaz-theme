{% import 'partials/nav_macros.html.twig' as nav %}

<header
  class="sticky top-0 z-40 w-full border-b border-neutral-200 bg-neutral-100 bg-opacity-70 backdrop-blur"
>
  <div class="max-w-6xl mx-auto px-4">
    {# 3 zones: left (logo) | center (nav) | right (languages) #}
    <div class="flex items-center gap-4 h-24 md:h-[112px] relative">
      {# LEFT: logo #}
      <div class="flex flex-1 items-center justify-start">
        <a href="{{ base_url_absolute }}" class="flex items-center gap-3">
          <img
            src="{{ url('theme://images/logo.png') }}"
            alt="Beato Rosaz"
            class="h-12 md:h-14 w-auto object-contain"
          />
        </a>
      </div>

      {# CENTER: main navigation (desktop) #}
      <nav class="nav-main hidden md:flex flex-none justify-center">
        <ul class="flex items-center gap-6">
          {% for p in pages.children.visible %} {% set has_children =
          p.children.visible|length > 0 %}

          <li class="group">
            <a
              {% if not has_children %}href="{{ p.url }}"{% endif %}
              class="cursor-pointer nav-link inline-flex items-center py-1.5 border-b-2 border-transparent transition {% if p.active or p.activeChild %} text-orange-500 border-orange-500 font-semibold {% else %} text-neutral-800 hover:text-orange-500 hover:border-orange-300 {% endif %}"
            >
              {{ p.menu }}
            </a>

            {% if has_children %}
              <div
                class="pointer-events-none opacity-0 group-hover:opacity-100 group-hover:pointer-events-auto transition-opacity duration-200 absolute left pt-[38px]"
              >
                {{ nav.dropdown_items(p, 0) }}
              </div>
            {% endif %}
          </li>

          {% endfor %}
        </ul>
      </nav>

      {# RIGHT: language switcher + mobile button #}
      <div class="flex flex-1 items-center justify-end gap-3">
        {# Language selector (desktop only) #}
        <div class="hidden md:flex items-center gap-2 text-xs">
          {% for lang in grav.language.getLanguages %} {% set is_active =
          (grav.language.getActive == lang) %} {% set lang_prefix =
          grav.language.getLanguageURLPrefix(lang) %} {% set lang_url =
          base_url_simple ~ lang_prefix ~ page.rawRoute %}

          <a
            href="{{ lang_url }}"
            class="uppercase tracking-wide px-2 py-1 rounded
                {{
              is_active
                ? 'font-bold text-orange-600 bg-orange-50 border border-orange-300'
                : 'text-neutral-500 hover:text-orange-600 border border-transparent hover:border-orange-300'
            }}"
          >
            {{ lang }}
          </a>
          {% endfor %}
        </div>

        {# Mobile menu button #}
        <button
          class="md:hidden inline-flex items-center justify-center p-2 rounded-md border border-neutral-300 text-neutral-700 bg-white/80 transition-colors duration-150 hover:bg-neutral-100 hover:border-orange-300 hover:text-orange-500 focus:outline-none focus:ring-2 focus:ring-orange-300 focus:ring-offset-2 focus:ring-offset-neutral-100 active:scale-95"
          type="button"
          aria-label="Toggle navigation"
          aria-expanded="false"
          data-nav-toggle
        >
          <span class="sr-only">Menu</span>

          {# Icon: hamburger (open state) #}
          <svg
            data-icon-open
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            class="h-6 w-6"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M4 7h16" />
            <path d="M4 12h16" />
            <path d="M4 17h16" />
          </svg>

          {# Icon: close (when menu is open) #}
          <svg
            data-icon-close
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            class="h-6 w-6 hidden"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M6 6l12 12" />
            <path d="M18 6l-12 12" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  {# Mobile navigation panel - full width, only top-level pages #}
  <nav
    class="nav-main-mobile md:hidden absolute left-0 right-0 top-full border-b border-neutral-200 bg-neutral-100/95 backdrop-blur shadow-sm opacity-0 -translate-y-2 pointer-events-none transform transition-all duration-200 ease-out"
    data-nav-panel
  >
    <ul class="flex flex-col gap-1 px-3 py-4 text-base">
      {% for p in pages.children.visible %}
      <li>
        <a
          href="{{ p.url }}"
          class="block w-full rounded-md px-3 py-2 text-neutral-800 transition-colors duration-200 hover:bg-orange-500 hover:text-neutral-100"
        >
          {{ p.menu }}
        </a>
      </li>
      {% endfor %}
    </ul>
  </nav>
</header>
