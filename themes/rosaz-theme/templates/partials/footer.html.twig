{# 1) Resolve current theme config (fallback) #}
{% set theme_name = config.system.pages.theme %}
{% set theme = attribute(config.themes, theme_name)|default({}) %}
{% set theme_footer = theme.footer ?? {} %}

{# 2) Try to find footer-config page (per-language content) #}
{% set footer_page = pages.find('/footer-config') %}
{% set h = footer_page ? footer_page.header : {} %}

{# 3) Merge data: page header has priority, theme config is fallback #}
{% set background_color = h.background_color
  ?? theme_footer.background_color
  ?? '#020617'  %} {# default: slate-900-like #}

{% set cta = h.cta ?? theme_footer.cta ?? {} %}
{% set columns = h.columns ?? theme_footer.columns ?? [] %}
{% set contact = h.contact ?? theme_footer.contact ?? {} %}
{% set copyright = h.copyright ?? theme_footer.copyright ?? {} %}

<footer
  class="relative w-full text-neutral-200 px-8"
  style="background-color: {{ background_color }};"
>
  <div class="relative max-w-6xl mx-auto px-4 py-12 md:py-16">
    <div class="flex flex-col lg:flex-row gap-10 lg:gap-16">
      {# Left: donation CTA #}
      <div class="lg:w-4/12 space-y-6">
        {% if cta.title %}
          <h2 class="text-xl md:text-2xl lg:text-3xl font-heading font-semibold text-white leading-snug">
            {{ cta.title }}
          </h2>
        {% endif %}

        {% if cta.subtitle %}
          <p class="text-sm md:text-base text-neutral-300 max-w-md">
            {{ cta.subtitle }}
          </p>
        {% endif %}

        {% set button_label = cta.button_label ?? '' %}
        {% set button_url = cta.button_url ?? '#' %}
        {% set is_external =
          button_url starts with 'http' or
          button_url starts with 'mailto:' or
          button_url starts with 'tel:'
        %}

        {% if button_label %}
          <a
            href="{{ button_url }}"
            {% if is_external %}target="_blank" rel="noopener noreferrer"{% endif %}
            class="inline-flex items-center gap-3 rounded-full bg-orange-500 px-7 py-2 text-sm font-semibold text-white shadow-md hover:bg-orange-600 transition-colors duration-200"
          >
            <span
              class="flex h-6 w-6 items-center justify-center rounded-full bg-white text-orange-500 text-md"
            >
              ‚ô•
            </span>
            <span class="uppercase tracking-[0.16em]">
              {{ button_label }}
            </span>
          </a>
        {% endif %}
      </div>

      {# Right: columns + contact #}
      <div class="lg:w-7/12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 text-sm">
        {# Dynamic columns (Links, Mission, etc.) #}
        {% for col in columns %}
          <div>
            {% if col.title %}
              <h3 class="text-base font-heading font-semibold text-white mb-4">
                {{ col.title }}
              </h3>
            {% endif %}

            {% if col.items %}
              <ul class="space-y-2 text-neutral-300">
                {% for link in col.items %}
                  <li>
                    <a
                      href="{{ link.url ?? '#' }}"
                      class="hover:text-white transition-colors duration-150"
                    >
                      {{ link.label }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
        {% endfor %}

        {# Contact column #}
        <div>
          <h3 class="text-base font-heading font-semibold text-white mb-4">
            {{ contact.title ?? 'Contact' }}
          </h3>

          <div class="space-y-4 text-neutral-300">
            {% if contact.email %}
              <div class="flex items-start gap-3">
                <span class="text-orange-400">@</span>
                <a
                  href="mailto:{{ contact.email }}"
                  class="hover:text-white transition-colors duration-150"
                >
                  {{ contact.email }}
                </a>
              </div>
            {% endif %}

            {% if contact.phone %}
              <div class="flex items-start gap-3">
                <span class="text-orange-400">‚òé</span>
                <a
                  href="tel:{{ contact.phone|replace({' ': ''}) }}"
                  class="hover:text-white transition-colors duration-150"
                >
                  {{ contact.phone }}
                </a>
              </div>
            {% endif %}

            {% if contact.address_lines %}
              <div class="flex items-start gap-3">
                <span class="text-orange-400">üìç</span>
                <div>
                  {% for line in contact.address_lines %}
                    {# Accept both { text: '...' } and plain strings #}
                    {% set value = line.text is defined ? line.text : line %}
                    <p class="whitespace-nowrap">
                      {{ value }}
                    </p>
                  {% endfor %}
                </div>
              </div>
            {% endif %}


          </div>
        </div>
      </div>
    </div>
  </div>

  {# Bottom bar: copyright #}
  <div class="relative border-t border-slate-800">
    <div
      class="max-w-6xl mx-auto px-4 py-4 text-xs text-neutral-400 flex flex-col md:flex-row items-center justify-between gap-2"
    >
      <p class="text-center md:text-left">
        &copy; {{ "now"|date("Y") }}
        {% if copyright.text %}
          {{ copyright.text }}
        {% else %}
          {{ site.title|default('Suore Francescane di Susa') }}. All rights reserved.
        {% endif %}
      </p>

      <p>
        {% if copyright.built_with %}
          {{ copyright.built_with }}
        {% else %}
          Built with Grav & Tailwind.
        {% endif %}
      </p>
    </div>
  </div>
</footer>
